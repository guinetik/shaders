# Shader Gallery — Design Document

## Overview

A static portfolio site showcasing Shadertoy shaders with the "Neutron UI" aesthetic. Users browse a grid of shader thumbnails, click into a detail view with live WebGL rendering and syntax-highlighted GLSL code, and link out to Shadertoy/ShaderKit.

**Stack:** Vue 3 + TypeScript + Vite (static site)
**Deploy target:** GitHub Pages

## Project Structure

```
shaders/
├── public/
│   └── shaders/                    # Shader screenshots (served as-is)
│       └── <slug>/
│           └── screenshot.png
├── src/
│   ├── assets/
│   │   └── neutron.css             # Neutron UI theme (CSS custom properties)
│   ├── components/
│   │   ├── ShaderCard.vue          # Gallery thumbnail card
│   │   ├── ShaderRenderer.vue      # WebGL canvas (thin, delegates to composable)
│   │   ├── CodeViewer.vue          # Shiki-highlighted read-only code
│   │   └── TagFilter.vue           # Tag pill filter bar
│   ├── composables/
│   │   ├── useShaderGallery.ts     # Gallery filtering, sorting logic
│   │   ├── useShaderRenderer.ts    # WebGL2 setup, multi-pass FBO pipeline, animation loop
│   │   └── useShaderDetail.ts      # Single shader data loading from registry
│   ├── services/
│   │   └── shaderRegistry.ts       # Typed access to virtual:shader-registry
│   ├── shaders/                    # Shader source data (build-time discovered)
│   │   └── <slug>/
│   │       ├── meta.json           # { title, description, date, tags, links, channels? }
│   │       ├── image.glsl          # Main output pass (required)
│   │       ├── buffer-a.glsl       # Buffer A (optional)
│   │       ├── buffer-b.glsl       # Buffer B (optional)
│   │       ├── buffer-c.glsl       # Buffer C (optional)
│   │       └── buffer-d.glsl       # Buffer D (optional)
│   ├── plugins/
│   │   └── shaderLoader.ts         # Vite plugin: scans shader folders, generates virtual module
│   ├── theme/
│   │   └── neutron-theme.ts        # Typed theme constants (colors, spacing, fonts)
│   ├── constants.ts                # Named constants (no magic numbers)
│   ├── types.ts                    # All interfaces/types with TSDoc
│   ├── router.ts                   # Vue Router (hash mode)
│   ├── App.vue
│   └── main.ts
├── index.html
├── package.json
├── tsconfig.json
└── vite.config.ts
```

## TypeScript Conventions

- **Strict mode** (`strict: true` in tsconfig)
- **No `any`** — explicit types everywhere
- **TSDoc** (`/** */`) on all public interfaces, types, exported functions, and composables
- **Named constants** for all magic numbers/strings in `src/constants.ts`
- **Domain logic separation** — `.vue` files are thin (template + styling + reactive bindings). All logic lives in composables (`use*.ts`) acting as controllers.

## Core Types

```ts
/** Supported external links for a shader entry */
interface ShaderLinks {
  /** URL to the shader on Shadertoy */
  shadertoy?: string;
  /** URL to the shader on ShaderKit */
  shaderkit?: string;
}

/** Channel binding target for multi-pass shaders */
type ChannelTarget = 'buffer-a' | 'buffer-b' | 'buffer-c' | 'buffer-d' | 'self';

/** Channel bindings for a single pass */
type ChannelBindings = Partial<Record<'iChannel0' | 'iChannel1' | 'iChannel2' | 'iChannel3', ChannelTarget>>;

/** Channel configuration for all passes */
type ShaderChannels = Partial<Record<'image' | 'bufferA' | 'bufferB' | 'bufferC' | 'bufferD', ChannelBindings>>;

/** Shader source code organized by render pass */
interface ShaderPasses {
  /** Main output pass (always present) */
  image: string;
  /** Buffer A source (optional) */
  bufferA?: string;
  /** Buffer B source (optional) */
  bufferB?: string;
  /** Buffer C source (optional) */
  bufferC?: string;
  /** Buffer D source (optional) */
  bufferD?: string;
}

/** Metadata for a single shader in the gallery */
interface ShaderMeta {
  /** URL-friendly identifier, derived from folder name */
  slug: string;
  /** Display title */
  title: string;
  /** Brief description of the shader effect */
  description: string;
  /** ISO 8601 date string (YYYY-MM-DD) */
  date: string;
  /** Categorization tags (e.g., "raymarching", "noise") */
  tags: string[];
  /** External links to shader platforms */
  links: ShaderLinks;
}

/** Complete shader entry as generated by the Vite plugin */
interface ShaderEntry extends ShaderMeta {
  /** Path to the screenshot image */
  screenshotUrl: string;
  /** GLSL source code per render pass */
  passes: ShaderPasses;
  /** Channel wiring between passes */
  channels: ShaderChannels;
}
```

## Multi-Pass Rendering

### Folder Convention

Each shader folder can contain multiple `.glsl` files following Shadertoy's buffer model:

- `image.glsl` — Main output pass (required)
- `buffer-a.glsl` through `buffer-d.glsl` — Optional buffer passes

### Channel Wiring

Default (matches Shadertoy): `iChannel0 = buffer-a`, buffers read from `self` (previous frame feedback). Override via `channels` field in `meta.json`:

```json
{
  "channels": {
    "image": { "iChannel0": "buffer-a" },
    "bufferA": { "iChannel0": "self" }
  }
}
```

### Renderer Pipeline

The `useShaderRenderer` composable:

1. Creates WebGL2 context
2. Compiles each pass into a separate program
3. Allocates ping-pong FBOs for each buffer (for feedback)
4. Each frame: renders buffers in order (A -> B -> C -> D), then image pass to screen
5. Binds buffer FBO outputs as textures according to channel wiring
6. Provides standard Shadertoy uniforms: `iTime`, `iResolution`, `iMouse`, `iFrame`
7. Pauses on `document.visibilitychange`
8. Cleans up all WebGL resources on unmount

## Neutron UI Theme

Ported from the `NeutronTheme` system in `feynman.ui.js`. Core identity: oscilloscope/particle detector aesthetic.

### Color System

Multi-variant color palettes exposed as CSS custom properties:

| Token | Cyan (default) | Usage |
|-------|----------------|-------|
| `--n-primary` | `#0ff` | Accents, active states, headings |
| `--n-glow` | `rgba(0, 200, 255, 0.4)` | Box shadows, border glow |
| `--n-bg` | `rgba(0, 5, 10, 0.95)` | Panel backgrounds |
| `--n-bg-hover` | `rgba(0, 200, 255, 0.15)` | Hover states |
| `--n-border` | `rgba(0, 200, 255, 0.4)` | Default borders |
| `--n-border-active` | `#0ff` | Active/hover borders |
| `--n-text` | `#0ff` | Primary text |
| `--n-text-dim` | `rgba(0, 200, 255, 0.5)` | Secondary/muted text |
| `--n-text-white` | `#fff` | Body text |

Additional variants (magenta, yellow, green, danger) used for tag pills and accents.

### Typography

- **All text:** Fira Code, monospace
- **Font scale:** named constants (`FONT_SIZE_XS` through `FONT_SIZE_XL`)

### Spacing

Named scale: `xs: 4, sm: 8, md: 12, lg: 16, xl: 24` (in px)

### Visual Elements

- Dark panel backgrounds with cyan glow borders
- `box-shadow` glow on hover (cyan, `blur: 40px`)
- Left accent bars on cards (3px wide, variant color)
- Tag pills with variant-colored borders and text

## Pages

### Gallery (`/`)

- Responsive CSS grid: 1 col mobile, 2 col tablet, 3 col desktop
- Tag filter bar at top (cyan pill buttons, glow on active)
- Cards: screenshot + title overlay + tags
- Hover: border brightens, subtle glow shadow

### Shader Detail (`/shader/:slug`)

- Toggle tab bar at top: "Render" | "Code"
- **Render tab:** Full-width WebGL canvas, shader running live
- **Code tab:** Shiki-highlighted GLSL (read-only), sub-tabs per pass if multi-pass
- Below toggle: title, description, date, tag pills, external link buttons
- Back button to gallery

### Mobile-First

- All layouts mobile-first, scaled up via media queries
- Minimum 44px touch targets
- Toggle tabs large and thumb-accessible

## Dependencies

- `vue` ^3.x
- `vue-router` ^4.x
- `shiki` (syntax highlighting)
- `vite` ^6.x
- No other runtime dependencies — WebGL2 is native, CSS handles layout

## What We Are NOT Building (YAGNI)

- No shader editor
- No user accounts
- No backend/API
- No search (tag filtering suffices)
- No page transition animations
